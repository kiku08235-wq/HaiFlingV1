-- Haidz Fling GUI v2.2 - Tự quay lại vị trí cũ và giữ menu sau khi chết

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local originalCFrame
local flingOn = false
local connection
local selectedTarget

-- Tạo GUI
local function createFlingGUI()
	local playerGui = LocalPlayer:WaitForChild("PlayerGui")

	-- Xóa nếu có sẵn
	if playerGui:FindFirstChild("HaidzFlingGui") then
		playerGui.HaidzFlingGui:Destroy()
	end

	local gui = Instance.new("ScreenGui")
	gui.Name = "HaidzFlingGui"
	gui.ResetOnSpawn = false
	gui.Parent = playerGui

	local mainFrame = Instance.new("Frame", gui)
	mainFrame.Size = UDim2.new(0, 300, 0, 250)
	mainFrame.Position = UDim2.new(0.5, -150, 0.5, -125)
	mainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
	mainFrame.BorderSizePixel = 0
	mainFrame.Active = true
	mainFrame.Draggable = true

	local toggleButton = Instance.new("TextButton", gui)
	toggleButton.Size = UDim2.new(0, 120, 0, 30)
	toggleButton.Position = UDim2.new(1, -130, 0, 10) -- Góc phải trên
	toggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	toggleButton.Text = "Ẩn Haidz"
	toggleButton.TextColor3 = Color3.new(1, 1, 1)
	toggleButton.Font = Enum.Font.SourceSansBold
	toggleButton.TextSize = 18

	toggleButton.MouseButton1Click:Connect(function()
		mainFrame.Visible = not mainFrame.Visible
		toggleButton.Text = mainFrame.Visible and "Ẩn Haidz" or "Hiện Haidz"
	end)

	local title = Instance.new("TextLabel", mainFrame)
	title.Size = UDim2.new(1, 0, 0, 30)
	title.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	title.Text = "Haidz Fling"
	title.TextColor3 = Color3.new(1, 1, 1)
	title.Font = Enum.Font.SourceSansBold
	title.TextSize = 20

	local dropdownToggle = Instance.new("TextButton", mainFrame)
	dropdownToggle.Size = UDim2.new(0.9, 0, 0, 30)
	dropdownToggle.Position = UDim2.new(0.05, 0, 0.2, 0)
	dropdownToggle.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	dropdownToggle.Text = "Chọn Player ↓"
	dropdownToggle.TextColor3 = Color3.new(1, 1, 1)
	dropdownToggle.Font = Enum.Font.SourceSans
	dropdownToggle.TextSize = 18

	local dropdownFrame = Instance.new("Frame", mainFrame)
	dropdownFrame.Size = UDim2.new(0.9, 0, 0, 100)
	dropdownFrame.Position = UDim2.new(0.05, 0, 0.35, 0)
	dropdownFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	dropdownFrame.Visible = false
	dropdownFrame.ClipsDescendants = true

	local scrolling = Instance.new("ScrollingFrame", dropdownFrame)
	scrolling.Size = UDim2.new(1, 0, 1, 0)
	scrolling.CanvasSize = UDim2.new(0, 0, 0, 0)
	scrolling.ScrollBarThickness = 6
	scrolling.BackgroundTransparency = 1
	scrolling.AutomaticCanvasSize = Enum.AutomaticSize.Y

	local UIListLayout = Instance.new("UIListLayout", scrolling)
	UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
	UIListLayout.Padding = UDim.new(0, 5)

	-- Chọn người chơi
	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer then
			local button = Instance.new("TextButton", scrolling)
			button.Size = UDim2.new(1, 0, 0, 30)
			button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
			button.TextColor3 = Color3.new(1, 1, 1)
			button.Font = Enum.Font.SourceSans
			button.TextSize = 18
			button.Text = plr.Name

			button.MouseButton1Click:Connect(function()
				selectedTarget = plr
				dropdownToggle.Text = "Đã chọn: " .. plr.Name .. " ↓"
				dropdownFrame.Visible = false
			end)
		end
	end

	dropdownToggle.MouseButton1Click:Connect(function()
		dropdownFrame.Visible = not dropdownFrame.Visible
		dropdownToggle.Text = dropdownFrame.Visible and "Chọn Player ↑" or "Chọn Player ↓"
	end)

	-- Fling
	local flingBtn = Instance.new("TextButton", mainFrame)
	flingBtn.Size = UDim2.new(0.9, 0, 0, 35)
	flingBtn.Position = UDim2.new(0.05, 0, 0.8, 0)
	flingBtn.BackgroundColor3 = Color3.fromRGB(60, 0, 0)
	flingBtn.TextColor3 = Color3.new(1, 1, 1)
	flingBtn.Font = Enum.Font.SourceSansBold
	flingBtn.TextSize = 20
	flingBtn.Text = "Bắt đầu Fling"

	local function stopFling()
		flingOn = false
		if connection then connection:Disconnect() end

		-- Quay lại chỗ cũ
		local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
		if hrp and originalCFrame then
			hrp.Anchored = true
			hrp.CFrame = originalCFrame
			task.wait(2)
			hrp.Anchored = false
		end
	end

	local function startFling()
		local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
		if not hrp or not selectedTarget or not selectedTarget.Character then return end

		originalCFrame = hrp.CFrame
		flingOn = true

		connection = RunService.Heartbeat:Connect(function()
			local targetHRP = selectedTarget.Character and selectedTarget.Character:FindFirstChild("HumanoidRootPart")
			if not flingOn or not targetHRP or not hrp then
				stopFling()
				return
			end

			hrp.CFrame = targetHRP.CFrame
			hrp.Velocity = Vector3.new(9999, 9999, 9999)
			hrp.RotVelocity = Vector3.new(10000, 10000, 10000)
		end)
	end

	flingBtn.MouseButton1Click:Connect(function()
		if not flingOn and selectedTarget then
			startFling()
			flingBtn.Text = "Dừng Fling"
		else
			stopFling()
			flingBtn.Text = "Bắt đầu Fling"
		end
	end)

	-- Khi chết, giữ GUI và tự tạo lại nhân vật
	LocalPlayer.CharacterAdded:Connect(function()
		task.wait(2)
		createFlingGUI()
	end)
end

createFlingGUI()
